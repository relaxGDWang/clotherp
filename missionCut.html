<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <title>裁剪任务</title>
    <!-- build:css library/style/webcommon.css -->
    <link rel="stylesheet" href="library/style/font-awesome.css"/>
    <link rel="stylesheet" href="library/style/elementui2.4.11.css"/>
    <link rel="stylesheet" href="library/style/cssreset3.css"/>
    <!-- endbuild -->
    <!-- build:css style/list.css -->
    <link rel="stylesheet" href="style/list.css"/>
    <!-- endbuild -->
    <script src="script/configBG.js"></script>
</head>
<body>
<div class="outFrame" id="app">
    <div class="main">
        <div class="searchBar">
            <span class="rexBlockCheck" color="warning"><input type="radio" v-model="search.listType" value="doing" name="listType"/><label>待处理</label></span>
            <span class="rexBlockCheck" color="warning"><input type="radio" v-model="search.listType" value="cut" name="listType"/><label>已完成</label></span>
            <button class="rexButton" @click="getList()"><span class="fa fa-refresh"></span></button>
            <span>{{currentPosition}}</span>
            <div class="equipment">登录：<strong>{{username}}</strong></div>
        </div>
        <el-table :data="mission" :height="UI.listHeight" border stripe>
            <el-table-column label="#" width="40">
                <template slot-scope="scope">{{scope.$index+1}}</template>
            </el-table-column>
            <el-table-column prop="product_code" label="商品编号" width="100"></el-table-column>
            <el-table-column prop="bolt_no" label="卷号" width="165"></el-table-column>
            <el-table-column prop="purchaser" label="客户"></el-table-column>
            <el-table-column label="裁剪" width="80">
                <template slot-scope="scope">
                    {{scope.row.length}}米
                </template>
            </el-table-column>
            <el-table-column prop="position" label="仓位"></el-table-column>
            <el-table-column label="布长" width="100">
                <template slot-scope="scope">
                    {{scope.row.current_length}}米
                </template>
            </el-table-column>
            <el-table-column prop="catalog" label="类型" width="80"></el-table-column>
            <el-table-column label="操作" width="50">
                <template slot-scope="scope">
                    <span class="opButton fa fa-cut" @click="openDetails(scope.row.bolt_id)" v-if="search.listType==='doing'"></span>
                    <span class="opButton fa fa-folder-open-o" @click="openDetails(scope.row.bolt_id)" v-if="search.listType!=='doing'"></span>
                </template>
            </el-table-column>
        </el-table>
    </div>

    <!-- 详细页 -->
    <div class="extPage missionDetails" id="opDetails">
        <div class="dialogFrame">
            <div class="dialog-title">
                <span class="right opBtn btn-close">&times;</span>
                <h4><span class="fa fa-cut"></span> 裁剪任务详细</h4>
            </div>
            <div class="dialog-content">
                <div class="leftPart">
                    <ul class="viewList nohead" v-if="editObject">
                        <li v-for="item in editObject.splits" :class="{'sel':(item.bolt_id===editObject.viewObj.bolt_id),'fin':(item.status_code!=='mark')}" @click="setViewObject(editObject, item.bolt_id)">
                            <span class="status" :class="getTypeString(item)"></span>
                            <span class="length">裁剪<b>{{item.cut_length}}</b>米</span>
                            <strong>{{item.bolt_no}}</strong>
                        </li>
                    </ul>
                </div>
                <div class="rightPart">
                    <ul class="baseInfo nohead" v-if="editObject">
                        <li><label>商品编号：</label><span>{{editObject.product}}</span></li>
                        <li><label>卷 号：</label><span>{{editObject.bolt}}</span></li>
                        <li><label>仓 位：</label><span>{{editObject.position}}</span></li>
                    </ul>
                    <rex-cloth :len="UI.len" :flaws="editObject.defects" :pos="currentPosition" :cuts="editObject.splits" :select="editObject.viewObj" :first="editObject.first" v-if="editObject"></rex-cloth>
                    <div class="operateShow" v-if="editObject">
                        <div class="operate">
                            <span class="status" :class="getTypeString(editObject.viewObj)"></span>
                            <span class="title">计米器读数 <b>{{currentPosition===''? '--': currentPosition}}</b> <span>/{{editObject.viewObj.cut_length}}米</span></span>
                            <ul class="elseInfo nohead" v-if="getTypeString(editObject.viewObj)==='customer'">
                                <li><label>客户信息：</label><span>{{editObject.viewObj.purchaser}}</span></li>
                                <li><label>订货长度：</label><span>{{editObject.viewObj.order_length}}米</span></li>
                            </ul>
                            <ul class="elseInfo" v-if="getTypeString(editObject.viewObj)!=='customer'">
                                <li class="center">当前为疵点处理或者分裁入库</li>
                            </ul>
                            <div class="maskShow" v-if="editObject.viewObj.bolt_id!==editObject.first"><span id="focusDom"><template v-if="editObject.first">请先处理该布匹的第一个未完成的裁剪任务！</template><template v-if="!editObject.first">当前布匹无裁剪任务！</template></span></div>
                        </div>
                        <div class="operateButton">
                            <div class="buttonList" @mousedown="showFocus($event)">
                                <button class="rexButton" color="info" @click="operateFlaw()" :disabled="!editObject.first">
                                    <span class="fa fa-tag"></span><span>新疵点</span>
                                </button><button class="rexButton" color="info" @click="resetLength()" :disabled="!editObject.first">
                                    <span class="fa fa-edit"></span><span>布长修正</span>
                                </button><button class="rexButton" color="info" @click="printDoing()">
                                    <span class="fa fa-barcode"></span><span>打印编号</span>
                                </button><button id="doFinish" class="rexButton" color="warning" :disabled="editObject.viewObj.bolt_id!==editObject.first" @click="askFinish()">
                                    <span class="fa fa-check-square-o"></span><span>完成裁剪</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="elseList" v-if="editObject" :style="{height:UI.bottomHeight+'px'}">
                        <div class="flawList">
                            <h3>疵点列表</h3>
                            <ul class="nohead">
                                <li v-for="(item, index) in editObject.defects">
                                    <span class="index" :class="{'point':(item.defect_type==='dot'),'block':(item.defect_type!=='dot')}">{{index+1}}</span>
                                    <span class="showtext"><label>位置：</label><b>{{item.position}}</b> 米<label>长度：</label><b>{{item.length || '--'}}</b> 米</span>
                                    <span class="opButton" @click="operateFlaw(item.bolt_id)" v-if="search.listType==='doing'">&times;</span>
                                </li>
                                <li v-if="!editObject.defects || editObject.defects.length===0">
                                    <span class="nodata">没有任何疵点信息</span>
                                </li>
                            </ul>
                        </div>
                        <div class="operateList">
                            <h3>裁剪记录</h3>
                            <ul class="nohead">
                                <li v-for="(item, index) in editObject.cutouts" class="cutRecord">
                                    <span class="datetime">{{item.date}}</span>
                                    <span class="op"><span class="name">{{item.name}}</span> 裁剪布段 <b>{{item.length}}</b> 米</span>
                                </li>
                                <li v-if="!editObject.cutouts || editObject.cutouts.length===0">
                                    <span class="nodata">没有任何裁剪记录</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ajax加载提示框 -->
    <div class="extDialog" id="loading" noclick="noclick">
        <div class="dialogFrame">
            <div class="dialog-content">
                <div class="loadingBlock"><div></div><div></div><div></div><div></div><div></div></div> <span class="diy">正在加载数据，请稍等...</span>
            </div>
        </div>
    </div>

    <!-- ajax出错信息提示 -->
    <div class="extDialog" id="information" noclick="noclick">
        <div class="dialogFrame">
            <div class="dialog-title">
                <h4><span class="fa fa-info-circle"></span> 系统信息提示</h4>
            </div>
            <div class="dialog-buttonBar">
                <button class="rexButton opBtn btn-cancel">取消</button>
                <button class="rexButton opBtn btn-sure">确定</button>
            </div>
            <div class="dialog-content">
                <div class="diy"></div>
            </div>
        </div>
    </div>

    <!-- 轻量信息提示 -->
    <div class="miniDialog bottom" id="resultShow">
        <div class="dialog-content">
            <span class="diy"></span>
        </div>
    </div>

    <!-- 重标布长 -->
    <div class="extDialog doing" id="reLength" noclick="noclick">
        <div class="dialogFrame">
            <div class="dialog-title">
                <h4><span class="fa fa-edit"></span> 重标布长操作</h4>
            </div>
            <div class="dialog-buttonBar">
                <button class="rexButton opBtn btn-close" :disabled="input.flag">取消</button>
                <button class="rexButton" color="info" @click="doResetLength()" :disabled="input.flag">提交修改</button>
            </div>
            <div class="dialog-content">
                <div class="row" v-if="editObject">
                    <label>当前布长</label><span><b>{{editObject.viewObj.current_length}}</b> 米</span>
                </div>
                <div class="row">
                    <label>重标布长</label>
                    <span><input type="tel" class="rexInput" maxlength="6" v-model.trim="input.len" :disabled="input.flag" readonly/> 米</span>
                </div>
                <div class="doingShow" v-if="input.msg">
                    <span :class="input.status"><div class="loadingBlock" v-if="input.flag && input.status==='loading'"><div></div><div></div><div></div><div></div><div></div></div> {{input.msg}}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增疵点 -->
    <div class="extDialog doing" id="addFlaw" noclick="noclick">
        <div class="dialogFrame">
            <div class="dialog-title">
                <h4><span class="fa fa-tag"></span> 新增疵点操作</h4>
            </div>
            <div class="dialog-buttonBar">
                <button class="rexButton opBtn btn-close" :disabled="input.flag">取消</button>
                <button class="rexButton" :disabled="input.flag" v-if="input.step===2" @click="goStep('prev')">上一步</button>
                <button class="rexButton" v-if="input.step===1" @click="goStep('next')">下一步</button>
                <button class="rexButton" color="info" @click="addOperateFlaw()" v-if="input.step===2" :disabled="input.flag">提交</button>
            </div>
            <div class="dialog-content">
                <div class="row">
                    <label>疵点开始位置</label>
                    <span><input type="tel" class="rexInput" maxlength="6" v-model.trim="input.start" :disabled="input.flag || input.step===2" readonly/> 米</span>
                </div>
                <div class="row" v-if="input.step===2">
                    <label>疵点结束位置</label>
                    <span><input type="tel" class="rexInput" maxlength="6" v-model.trim="input.end" :disabled="input.flag" readonly/> 米</span>
                </div>
                <div class="doingShow" v-if="input.msg">
                    <span :class="input.status"><div class="loadingBlock" v-if="input.flag && input.status==='loading'"><div></div><div></div><div></div><div></div><div></div></div> {{input.msg}}</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- build:js library/js/webcommon.js -->
<script src="library/js/jquery.min.js"></script>
<script src="library/js/vue.min.js"></script>
<script src="library/js/rexfunction.js"></script>
<script src="library/js/rexajax2.js"></script>
<script src="library/js/rexdialog.js"></script>
<script src="library/js/elementui2.4.11.js"></script>
<!-- endbuild -->
<!-- build:js script/missioncut.js -->
<script src="library/js/vueplug/clothShow.js"></script>
<script src="script/missioncut.js"></script>
<!-- endbuild -->
</body>
</html>